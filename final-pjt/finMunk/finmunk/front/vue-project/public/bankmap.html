<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì€í–‰ ì°¾ê¸°</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    h2 {
      color: #1a73e8;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #eaeaea;
    }

    /* ì„ íƒ UI ìŠ¤íƒ€ì¼ */
    .selection-area {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }

    select, button {
      padding: 12px;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 14px;
      flex-grow: 1;
      max-width: 200px;
      background-color: white;
    }

    select:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    select:disabled {
      background-color: #f1f1f1;
      cursor: not-allowed;
    }

    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
    }

    button:hover {
      background-color: #1557b0;
    }

    /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
    .main-content {
      display: flex;
      gap: 20px;
      height: 500px;
    }

    /* ì§€ë„ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .map-container {
      flex: 2;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #map {
      width: 100%;
      height: 100%;
    }

    /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
    .sidebar {
      flex: 1;
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 0;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tab-nav {
      display: flex;
      background-color: white;
      border-bottom: 1px solid #dee2e6;
    }

    .tab-button {
      flex: 1;
      padding: 15px 10px;
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }

    .tab-button.active {
      color: #1a73e8;
      border-bottom-color: #1a73e8;
      background-color: #f8f9fa;
    }

    .tab-button:hover:not(.active) {
      background-color: #f1f3f4;
    }

    /* íƒ­ ì»¨í…ì¸  */
    .tab-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
    }

    .tab-pane h3 {
      color: #1a73e8;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #1a73e8;
      padding-bottom: 8px;
    }

    .search-info {
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .search-info p {
      margin: 5px 0;
      font-size: 14px;
    }

    .bank-list {
      display: none;
    }

    .bank-item {
      background-color: white;
      margin-bottom: 12px;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-left: 4px solid #1a73e8;
    }

    .bank-item:hover {
      background-color: #e3f2fd;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .bank-item.active {
      background-color: #1a73e8;
      color: white;
    }

    .bank-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 5px;
      color: #1a73e8;
    }

    .bank-item.active .bank-name {
      color: white;
    }

    .bank-address {
      font-size: 13px;
      color: #666;
      margin-bottom: 3px;
    }

    .bank-item.active .bank-address {
      color: #e3f2fd;
    }

    .bank-phone {
      font-size: 13px;
      color: #1a73e8;
      font-weight: 500;
    }

    .bank-item.active .bank-phone {
      color: white;
    }

    .no-results {
      text-align: center;
      color: #666;
      padding: 40px 20px;
      font-style: italic;
    }

    /* ìƒì„¸ì •ë³´ ìŠ¤íƒ€ì¼ */
    .detail-view {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .detail-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .detail-header h4 {
      color: #1a73e8;
      margin: 0;
      font-size: 20px;
    }

    .detail-header p {
      color: #666;
      margin: 5px 0 0 0;
      font-size: 14px;
    }

    .detail-info {
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 500;
      color: #333;
      min-width: 80px;
    }

    .info-value {
      color: #666;
      text-align: right;
      flex: 1;
      margin-left: 10px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .action-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: #1a73e8;
      color: white;
    }

    .btn-primary:hover {
      background-color: #1557b0;
    }

    .btn-secondary {
      background-color: #f8f9fa;
      color: #1a73e8;
      border: 1px solid #1a73e8;
    }

    .btn-secondary:hover {
      background-color: #e3f2fd;
    }

    .no-selection {
      text-align: center;
      color: #999;
      padding: 40px 20px;
      font-style: italic;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #1a73e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .info-section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .info-section h5 {
      color: #1a73e8;
      margin: 0 0 12px 0;
      font-size: 16px;
      font-weight: 600;
    }

    /* ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
      .selection-area {
        flex-direction: column;
      }
      
      select, button {
        max-width: 100%;
      }
      
      .main-content {
        flex-direction: column;
        height: auto;
      }
      
      .map-container {
        height: 400px;
        order: 2;
      }
      
      .sidebar {
        order: 1;
        height: 300px;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>ì€í–‰ ì°¾ê¸°</h2>

  <!-- ì„ íƒ UI -->
  <div class="selection-area">
    <select id="sido">
      <option value="">ê´‘ì—­ì‹œ/ë„ ì„ íƒ</option>
      <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
      <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
      <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
      <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
      <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
      <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
      <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
      <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
      <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
      <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
      <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
      <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
      <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
      <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
      <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
      <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
      <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
    </select>

    <select id="sigungu" disabled>
      <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
    </select>

    <select id="bank">
      <option value="">ì€í–‰ ì„ íƒ</option>
      <option value="KBêµ­ë¯¼ì€í–‰">KBêµ­ë¯¼ì€í–‰</option>
      <option value="ì‹ í•œì€í–‰">ì‹ í•œì€í–‰</option>
      <option value="ìš°ë¦¬ì€í–‰">ìš°ë¦¬ì€í–‰</option>
      <option value="í•˜ë‚˜ì€í–‰">í•˜ë‚˜ì€í–‰</option>
      <option value="NHë†í˜‘ì€í–‰">NHë†í˜‘ì€í–‰</option>
      <option value="IBKê¸°ì—…ì€í–‰">IBKê¸°ì—…ì€í–‰</option>
      <option value="SCì œì¼ì€í–‰">SCì œì¼ì€í–‰</option>
      <option value="ì”¨í‹°ì€í–‰">ì”¨í‹°ì€í–‰</option>
      <option value="ì¹´ì¹´ì˜¤ë±…í¬">ì¹´ì¹´ì˜¤ë±…í¬</option>
      <option value="ì¼€ì´ë±…í¬">ì¼€ì´ë±…í¬</option>
      <option value="í† ìŠ¤ë±…í¬">í† ìŠ¤ë±…í¬</option>
      <option value="ëŒ€êµ¬ì€í–‰">ëŒ€êµ¬ì€í–‰</option>
      <option value="ë¶€ì‚°ì€í–‰">ë¶€ì‚°ì€í–‰</option>
      <option value="ê´‘ì£¼ì€í–‰">ê´‘ì£¼ì€í–‰</option>
      <option value="ì „ë¶ì€í–‰">ì „ë¶ì€í–‰</option>
      <option value="ì œì£¼ì€í–‰">ì œì£¼ì€í–‰</option>
      <option value="ê²½ë‚¨ì€í–‰">ê²½ë‚¨ì€í–‰</option>
      <option value="ìˆ˜í˜‘ì€í–‰">ìˆ˜í˜‘ì€í–‰</option>
      <option value="ìƒˆë§ˆì„ê¸ˆê³ ">ìƒˆë§ˆì„ê¸ˆê³ </option>
      <option value="ì‹ í˜‘">ì‹ í˜‘</option>
    </select>

    <button onclick="searchBanks()">ì§€ë„ì—ì„œ ì°¾ê¸°</button>
  </div>

  <div class="main-content">
    <div class="map-container">
      <div id="map"></div>
    </div>
    
    <div class="sidebar">
      <div class="tab-nav">
        <button class="tab-button active" onclick="switchTab('list')">ê²€ìƒ‰ ê²°ê³¼</button>
        <button class="tab-button" onclick="switchTab('detail')">ìƒì„¸ ì •ë³´</button>
      </div>
      
      <div class="tab-content">
        <!-- ê²€ìƒ‰ ê²°ê³¼ íƒ­ -->
        <div class="tab-pane active" id="listTab">
          <h3>ê²€ìƒ‰ ê²°ê³¼</h3>
          <div class="search-info" id="searchInfo">
            <p><strong>ê²€ìƒ‰ ì¡°ê±´ì„ ì„ íƒí•˜ê³  'ì§€ë„ì—ì„œ ì°¾ê¸°' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</strong></p>
          </div>
          <div class="bank-list" id="bankList"></div>
        </div>
        
        <!-- ìƒì„¸ ì •ë³´ íƒ­ -->
        <div class="tab-pane" id="detailTab">
          <h3>ìƒì„¸ ì •ë³´</h3>
          <div id="detailContent">
            <div class="no-selection">
              ì€í–‰ì„ ì„ íƒí•˜ì‹œë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2ee82fff4768ac3148a6cb93cca23971&libraries=services,clusterer"></script>

<script>
const sigunguData = {
  "ì„œìš¸íŠ¹ë³„ì‹œ": ["ê°•ë‚¨êµ¬", "ê°•ë™êµ¬", "ê°•ë¶êµ¬", "ê°•ì„œêµ¬", "ê´€ì•…êµ¬", "ê´‘ì§„êµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ë…¸ì›êµ¬", "ë„ë´‰êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ë™ì‘êµ¬", "ë§ˆí¬êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ì„œì´ˆêµ¬", "ì„±ë™êµ¬", "ì„±ë¶êµ¬", "ì†¡íŒŒêµ¬", "ì–‘ì²œêµ¬", "ì˜ë“±í¬êµ¬", "ìš©ì‚°êµ¬", "ì€í‰êµ¬", "ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ì¤‘ë‘êµ¬"],
  "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ê°•ì„œêµ¬", "ê¸ˆì •êµ¬", "ê¸°ì¥êµ°", "ë‚¨êµ¬", "ë™êµ¬", "ë™ë˜êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë¶êµ¬", "ì‚¬ìƒêµ¬", "ì‚¬í•˜êµ¬", "ì„œêµ¬", "ìˆ˜ì˜êµ¬", "ì—°ì œêµ¬", "ì˜ë„êµ¬", "ì¤‘êµ¬", "í•´ìš´ëŒ€êµ¬"],
  "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ë‚¨êµ¬", "ë‹¬ì„œêµ¬", "ë‹¬ì„±êµ°", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬", "ìˆ˜ì„±êµ¬", "ì¤‘êµ¬"],
  "ì¸ì²œê´‘ì—­ì‹œ": ["ê°•í™”êµ°", "ê³„ì–‘êµ¬", "ë‚¨ë™êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ë¶€í‰êµ¬", "ì„œêµ¬", "ì—°ìˆ˜êµ¬", "ì˜¹ì§„êµ°", "ì¤‘êµ¬"],
  "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ê´‘ì‚°êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬"],
  "ëŒ€ì „ê´‘ì—­ì‹œ": ["ëŒ€ë•êµ¬", "ë™êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ì¤‘êµ¬"],
  "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì¤‘êµ¬", "ìš¸ì£¼êµ°"],
  "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": ["ì„¸ì¢…ì‹œ"],
  "ê²½ê¸°ë„": ["ê³ ì–‘ì‹œ", "ìˆ˜ì›ì‹œ", "ì„±ë‚¨ì‹œ", "ìš©ì¸ì‹œ", "ë¶€ì²œì‹œ", "ì•ˆì‚°ì‹œ", "ì•ˆì–‘ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "í™”ì„±ì‹œ", "í‰íƒì‹œ", "ì˜ì •ë¶€ì‹œ", "ì‹œí¥ì‹œ", "íŒŒì£¼ì‹œ", "ê¹€í¬ì‹œ", "ê´‘ëª…ì‹œ", "ê´‘ì£¼ì‹œ", "êµ°í¬ì‹œ", "ì˜¤ì‚°ì‹œ", "ì´ì²œì‹œ", "ì•ˆì„±ì‹œ", "ì˜ì™•ì‹œ", "í•˜ë‚¨ì‹œ", "ì—¬ì£¼ì‹œ", "ì–‘í‰êµ°", "ë™ë‘ì²œì‹œ", "ê³¼ì²œì‹œ", "ê°€í‰êµ°", "ì—°ì²œêµ°"],
  "ê°•ì›íŠ¹ë³„ìì¹˜ë„": ["ê°•ë¦‰ì‹œ", "ê³ ì„±êµ°", "ë™í•´ì‹œ", "ì‚¼ì²™ì‹œ", "ì†ì´ˆì‹œ", "ì–‘êµ¬êµ°", "ì–‘ì–‘êµ°", "ì˜ì›”êµ°", "ì›ì£¼ì‹œ", "ì¸ì œêµ°", "ì •ì„ êµ°", "ì² ì›êµ°", "ì¶˜ì²œì‹œ", "íƒœë°±ì‹œ", "í‰ì°½êµ°", "í™ì²œêµ°", "í™”ì²œêµ°", "íš¡ì„±êµ°"],
  "ì¶©ì²­ë¶ë„": ["ê´´ì‚°êµ°", "ë‹¨ì–‘êµ°", "ë³´ì€êµ°", "ì˜ë™êµ°", "ì˜¥ì²œêµ°", "ìŒì„±êµ°", "ì œì²œì‹œ", "ì§„ì²œêµ°", "ì²­ì£¼ì‹œ", "ì¶©ì£¼ì‹œ"],
  "ì¶©ì²­ë‚¨ë„": ["ê³„ë£¡ì‹œ", "ê³µì£¼ì‹œ", "ê¸ˆì‚°êµ°", "ë…¼ì‚°ì‹œ", "ë‹¹ì§„ì‹œ", "ë³´ë ¹ì‹œ", "ë¶€ì—¬êµ°", "ì„œì‚°ì‹œ", "ì„œì²œêµ°", "ì•„ì‚°ì‹œ", "ì˜ˆì‚°êµ°", "ì²œì•ˆì‹œ", "ì²­ì–‘êµ°", "íƒœì•ˆêµ°", "í™ì„±êµ°"],
  "ì „ë¼ë¶ë„": ["ê³ ì°½êµ°", "êµ°ì‚°ì‹œ", "ê¹€ì œì‹œ", "ë‚¨ì›ì‹œ", "ë¬´ì£¼êµ°", "ë¶€ì•ˆêµ°", "ìˆœì°½êµ°", "ì™„ì£¼êµ°", "ìµì‚°ì‹œ", "ì„ì‹¤êµ°", "ì¥ìˆ˜êµ°", "ì „ì£¼ì‹œ", "ì •ìì‹œ", "ì§„ì•ˆêµ°"],
  "ì „ë¼ë‚¨ë„": ["ê°•ì§„êµ°", "ê³ í¥êµ°", "ê³¡ì„±êµ°", "ê´‘ì–‘ì‹œ", "êµ¬ë¡€êµ°", "ë‚˜ì£¼ì‹œ", "ë‹´ì–‘êµ°", "ëª©í¬ì‹œ", "ë¬´ì•ˆêµ°", "ë³´ì„±êµ°", "ìˆœì²œì‹œ", "ì‹ ì•ˆêµ°", "ì—¬ìˆ˜ì‹œ", "ì˜ê´‘êµ°", "ì˜ì•”êµ°", "ì™„ë„êµ°", "ì¥ì„±êµ°", "ì¥í¥êµ°", "ì§„ë„êµ°", "í•¨í‰êµ°", "í•´ë‚¨êµ°", "í™”ìˆœêµ°"],
  "ê²½ìƒë¶ë„": ["ê²½ì‚°ì‹œ", "ê²½ì£¼ì‹œ", "ê³ ë ¹êµ°", "êµ¬ë¯¸ì‹œ", "êµ°ìœ„êµ°", "ê¹€ì²œì‹œ", "ë¬¸ê²½ì‹œ", "ë´‰í™”êµ°", "ìƒì£¼ì‹œ", "ì„±ì£¼êµ°", "ì•ˆë™ì‹œ", "ì˜ë•êµ°", "ì˜ì–‘êµ°", "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "ì˜ˆì²œêµ°", "ìš¸ë¦‰êµ°", "ìš¸ì§„êµ°", "ì˜ì„±êµ°", "ì²­ë„êµ°", "ì²­ì†¡êµ°", "ì¹ ê³¡êµ°", "í¬í•­ì‹œ"],
  "ê²½ìƒë‚¨ë„": ["ê±°ì œì‹œ", "ê±°ì°½êµ°", "ê³ ì„±êµ°", "ê¹€í•´ì‹œ", "ë‚¨í•´êµ°", "ë°€ì–‘ì‹œ", "ì‚¬ì²œì‹œ", "ì‚°ì²­êµ°", "ì–‘ì‚°ì‹œ", "ì˜ë ¹êµ°", "ì§„ì£¼ì‹œ", "ì°½ë…•êµ°", "ì°½ì›ì‹œ", "í†µì˜ì‹œ", "í•˜ë™êµ°", "í•¨ì•ˆêµ°", "í•¨ì–‘êµ°", "í•©ì²œêµ°"],
  "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì„œê·€í¬ì‹œ", "ì œì£¼ì‹œ"]
};

const sidoSelect = document.getElementById('sido');
const sigunguSelect = document.getElementById('sigungu');
let currentBankData = [];
let activeMarkerIndex = -1;
let selectedBank = null;

// ì‹œ/ë„ ë³€ê²½ ì‹œ êµ¬/êµ° ë“œë¡­ë‹¤ìš´ ë™ê¸°í™”
sidoSelect.addEventListener('change', function () {
  const selectedSido = this.value;
  sigunguSelect.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';

  if (selectedSido && sigunguData[selectedSido]) {
    sigunguData[selectedSido].forEach(sigungu => {
      const option = document.createElement('option');
      option.value = sigungu;
      option.textContent = sigungu;
      sigunguSelect.appendChild(option);
    });
    sigunguSelect.disabled = false;
  } else {
    sigunguSelect.disabled = true;
  }
});

// ì§€ë„ ì´ˆê¸°í™”
const mapContainer = document.getElementById('map');
const mapOption = {
  center: new kakao.maps.LatLng(37.5665, 126.9780),
  level: 5
};
const map = new kakao.maps.Map(mapContainer, mapOption);
const ps = new kakao.maps.services.Places();
const geocoder = new kakao.maps.services.Geocoder();
const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
let markers = [];

// íƒ­ ì „í™˜ í•¨ìˆ˜
function switchTab(tabName) {
  // íƒ­ ë²„íŠ¼ í™œì„±í™”
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
  
  // íƒ­ ì»¨í…ì¸  í‘œì‹œ
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.remove('active');
  });
  
  if (tabName === 'list') {
    document.getElementById('listTab').classList.add('active');
  } else if (tabName === 'detail') {
    document.getElementById('detailTab').classList.add('active');
  }
}

// ì¹´ì¹´ì˜¤ë§µ APIë¥¼ í™œìš©í•œ ìƒì„¸ì •ë³´ ì¡°íšŒ í•¨ìˆ˜ (ìˆ˜ì •ëœ ë²„ì „)
async function fetchDetailedPlaceInfo(place) {
  return new Promise((resolve) => {
    // ì¹´ì¹´ì˜¤ë§µ APIì˜ ì‹¤ì œ ê¸°ëŠ¥ë§Œ ì‚¬ìš©
    const searchKeyword = place.place_name;
    
    ps.keywordSearch(searchKeyword, (data, status) => {
      if (status === kakao.maps.services.Status.OK && data.length > 0) {
        // ê°€ì¥ ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ ì°¾ê¸°
        const matchedPlace = data.find(item => 
          item.place_name === place.place_name && 
          Math.abs(item.x - place.x) < 0.001 && 
          Math.abs(item.y - place.y) < 0.001
        ) || data[0];
        
        // ê¸°ì¡´ ì •ë³´ì™€ ìƒˆë¡œìš´ ì •ë³´ ë³‘í•©
        resolve({
          ...place,
          ...matchedPlace,
          detailsLoaded: true
        });
      } else {
        // ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ì •ë³´ ë°˜í™˜
        resolve({
          ...place,
          detailsLoaded: false
        });
      }
    }, {
      location: new kakao.maps.LatLng(place.y, place.x),
      radius: 100,
      size: 5
    });
  });
}

// ì£¼ë³€ ì •ë³´ ì¡°íšŒ í•¨ìˆ˜ (ì‹¤ì œ ì¹´ì¹´ì˜¤ë§µ ì¹´í…Œê³ ë¦¬ ì½”ë“œ ì‚¬ìš©)
async function getNearbyInfo(place) {
  return new Promise((resolve) => {
    const position = new kakao.maps.LatLng(place.y, place.x);
    const nearbyFacilities = [];
    let searchCount = 0;
    let completedCount = 0;
    
    const categories = [
      { code: 'MT1', name: 'ëŒ€í˜•ë§ˆíŠ¸', maxResults: 2 },
      { code: 'SW8', name: 'ì§€í•˜ì² ì—­', maxResults: 2 },
      { code: 'PK6', name: 'ì£¼ì°¨ì¥', maxResults: 3 },
      { code: 'BK9', name: 'ì€í–‰', maxResults: 3 }
    ];
    
    searchCount = categories.length;
    
    categories.forEach(category => {
      ps.categorySearch(category.code, (data, status) => {
        if (status === kakao.maps.services.Status.OK) {
          const facilities = data.slice(0, category.maxResults).map(item => ({
            name: item.place_name,
            category: category.name,
            distance: item.distance || calculateDistance(place, item)
          }));
          nearbyFacilities.push(...facilities);
        }
        
        completedCount++;
        if (completedCount === searchCount) {
          // ê±°ë¦¬ìˆœìœ¼ë¡œ ì •ë ¬
          nearbyFacilities.sort((a, b) => a.distance - b.distance);
          resolve(nearbyFacilities.slice(0, 5)); // ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ
        }
      }, {
        location: position,
        radius: 1000
      });
    });
    
    // íƒ€ì„ì•„ì›ƒ ì„¤ì • (3ì´ˆ)
    setTimeout(() => {
      if (completedCount < searchCount) {
        resolve(nearbyFacilities);
      }
    }, 3000);
  });
}

// ë‘ ì¥ì†Œ ê°„ ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
function calculateDistance(place1, place2) {
  const R = 6371000; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
  const lat1 = place1.y * Math.PI / 180;
  const lat2 = place2.y * Math.PI / 180;
  const deltaLat = (place2.y - place1.y) * Math.PI / 180;
  const deltaLng = (place2.x - place1.x) * Math.PI / 180;
  
  const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
    Math.cos(lat1) * Math.cos(lat2) *
    Math.sin(deltaLng/2) * Math.sin(deltaLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  
  return Math.round(R * c); // ë¯¸í„° ë‹¨ìœ„ë¡œ ë°˜í™˜
}

// ë‘ ì¢Œí‘œ ê°„ ê±°ë¦¬ ê³„ì‚° (km)
function getDistanceFromCoords(lat1, lng1, lat2, lng2) {
  const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
async function updateDetailView(place) {
  selectedBank = place;
  const detailContent = document.getElementById('detailContent');
  
  if (!place) {
    detailContent.innerHTML = `
      <div class="no-selection">
        ì€í–‰ì„ ì„ íƒí•˜ì‹œë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    `;
    return;
  }
  
  // ë¡œë”© í‘œì‹œ
  detailContent.innerHTML = `
    <div class="detail-view">
      <div class="detail-header">
        <h4>${place.place_name}</h4>
        <p>ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
      <div style="text-align: center; padding: 40px;">
        <div class="spinner" style="margin: 0 auto;"></div>
      </div>
    </div>
  `;
  
  try {
    // ì¹´ì¹´ì˜¤ë§µ APIë¡œ ì¶”ê°€ ì •ë³´ ì¡°íšŒ
    const [detailedPlace, nearbyInfo] = await Promise.all([
      fetchDetailedPlaceInfo(place),
      getNearbyInfo(place)
    ]);
    
    // ì€í–‰ë³„ ê¸°ë³¸ ì •ë³´
    const bankInfo = getBankInfo(detailedPlace.place_name);
    
    // í˜„ì¬ ì§€ë„ ì¤‘ì‹¬ì—ì„œì˜ ê±°ë¦¬ ê³„ì‚°
    const currentCenter = map.getCenter();
    const distance = getDistanceFromCoords(
      currentCenter.getLat(), 
      currentCenter.getLng(), 
      detailedPlace.y, 
      detailedPlace.x
    );
    
    // ìƒì„¸ì •ë³´ ë Œë”ë§
    detailContent.innerHTML = `
      <div class="detail-view">
        <div class="detail-header">
          <h4>${detailedPlace.place_name}</h4>
          <p>${detailedPlace.category_name || 'ì€í–‰/ê¸ˆìœµ'}</p>
          ${detailedPlace.category_group_name ? `<small style="color: #666;">${detailedPlace.category_group_name}</small>` : ''}
        </div>
        
        <div class="detail-info">
          <!-- ê¸°ë³¸ ì •ë³´ -->
          <div class="info-section">
            <h5>ğŸ“ ìœ„ì¹˜ ì •ë³´</h5>
            <div class="info-row">
              <span class="info-label">ì£¼ì†Œ</span>
              <span class="info-value">${detailedPlace.address_name}</span>
            </div>
            
            ${detailedPlace.road_address_name ? `
            <div class="info-row">
              <span class="info-label">ë„ë¡œëª…</span>
              <span class="info-value">${detailedPlace.road_address_name}</span>
            </div>
            ` : ''}
            
            <div class="info-row">
              <span class="info-label">ì§€ë„ì¤‘ì‹¬ê±°ë¦¬</span>
              <span class="info-value">${distance < 1 ? Math.round(distance * 1000) + 'm' : distance.toFixed(1) + 'km'}</span>
            </div>
            
            <div class="info-row">
              <span class="info-label">ì¢Œí‘œ</span>
              <span class="info-value">${parseFloat(detailedPlace.y).toFixed(6)}, ${parseFloat(detailedPlace.x).toFixed(6)}</span>
            </div>
          </div>
          
          <!-- ì—°ë½ì²˜ ì •ë³´ -->
          ${detailedPlace.phone ? `
          <div class="info-section">
            <h5>ğŸ“ ì—°ë½ì²˜</h5>
            <div class="info-row">
              <span class="info-label">ì „í™”ë²ˆí˜¸</span>
              <span class="info-value">${detailedPlace.phone}</span>
            </div>
          </div>
          ` : ''}
          
          <!-- ì˜ì—… ì •ë³´ -->
          <div class="info-section">
            <h5>ğŸ•’ ì˜ì—… ì‹œê°„</h5>
            <div class="info-row">
              <span class="info-label">í‰ì¼</span>
              <span class="info-value">${bankInfo.businessHours}</span>
            </div>
            <div class="info-row">
              <span class="info-label">í† ìš”ì¼</span>
              <span class="info-value">${bankInfo.saturdayHours}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ì¼ìš”ì¼</span>
              <span class="info-value">${bankInfo.sundayHours}</span>
            </div>
          </div>
          
          <!-- ì„œë¹„ìŠ¤ ì •ë³´ -->
          <div class="info-section">
            <h5>ğŸ¦ ì„œë¹„ìŠ¤</h5>
            <div class="info-row">
              <span class="info-label">ì œê³µ ì„œë¹„ìŠ¤</span>
              <span class="info-value">${bankInfo.services}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ì£¼ì°¨</span>
              <span class="info-value">${bankInfo.parking}</span>
            </div>
          </div>
          
          <!-- ì£¼ë³€ ì •ë³´ -->
          ${nearbyInfo.length > 0 ? `
          <div class="info-section">
            <h5>ğŸ“ ì£¼ë³€ ì‹œì„¤ (1km ë‚´)</h5>
            ${nearbyInfo.slice(0, 5).map(facility => `
              <div class="info-row">
                <span class="info-label">${facility.category}</span>
                <span class="info-value">${facility.name} (${facility.distance}m)</span>
              </div>
            `).join('')}
          </div>
          ` : ''}
          
          <!-- ì¶”ê°€ ì •ë³´ -->
          ${detailedPlace.place_url ? `
          <div class="info-section">
            <h5>ğŸ”— ì¶”ê°€ ì •ë³´</h5>
            <div class="info-row">
              <span class="info-label">ì¹´ì¹´ì˜¤ë§µ</span>
              <span class="info-value">
                <a href="${detailedPlace.place_url}" target="_blank" style="color: #1a73e8; text-decoration: none;">ìƒì„¸ë³´ê¸° â†’</a>
              </span>
            </div>
          </div>
          ` : ''}
        </div>
        
        <div class="action-buttons">
          <button class="action-btn btn-primary" onclick="focusOnMap()">
            ğŸ“ ì§€ë„ì—ì„œ ë³´ê¸°
          </button>
          ${detailedPlace.phone ? `
          <button class="action-btn btn-secondary" onclick="callBank()">
            ğŸ“ ì „í™”ê±¸ê¸°
          </button>
          ` : ''}
        </div>
        
        <div class="action-buttons" style="margin-top: 10px;">
          <button class="action-btn btn-secondary" onclick="openKakaoMap()">
            ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µì—ì„œ ë³´ê¸°
          </button>
          <button class="action-btn btn-secondary" onclick="getDirections()">
            ğŸš— ê¸¸ì°¾ê¸°
          </button>
        </div>
        
        <div class="action-buttons" style="margin-top: 10px;">
          <button class="action-btn btn-secondary" onclick="shareLocation()">
            ğŸ“¤ ìœ„ì¹˜ ê³µìœ 
          </button>
        </div>
      </div>
    `;
    
  } catch (error) {
    console.error('ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
    
    // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
    const bankInfo = getBankInfo(place.place_name);
    
    detailContent.innerHTML = `
      <div class="detail-view">
        <div class="detail-header">
          <h4>${place.place_name}</h4>
          <p>${place.category_name || 'ì€í–‰/ê¸ˆìœµ'}</p>
          <small style="color: #e74c3c;">ì¼ë¶€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small>
        </div>
        
        <div class="detail-info">
          <div class="info-section">
            <h5>ğŸ“ ê¸°ë³¸ ì •ë³´</h5>
            <div class="info-row">
              <span class="info-label">ì£¼ì†Œ</span>
              <span class="info-value">${place.address_name}</span>
            </div>
            
            ${place.phone ? `
            <div class="info-row">
              <span class="info-label">ì „í™”ë²ˆí˜¸</span>
              <span class="info-value">${place.phone}</span>
            </div>
            ` : ''}
          </div>
          
          <div class="info-section">
            <h5>ğŸ•’ ì˜ì—… ì‹œê°„ (ì¼ë°˜ì )</h5>
            <div class="info-row">
              <span class="info-label">í‰ì¼</span>
              <span class="info-value">${bankInfo.businessHours}</span>
            </div>
            <div class="info-row">
              <span class="info-label">í† ìš”ì¼</span>
              <span class="info-value">${bankInfo.saturdayHours}</span>
            </div>
          </div>
        </div>
        
        <div class="action-buttons">
          <button class="action-btn btn-primary" onclick="focusOnMap()">
            ğŸ“ ì§€ë„ì—ì„œ ë³´ê¸°
          </button>
          ${place.phone ? `
          <button class="action-btn btn-secondary" onclick="callBank()">
            ğŸ“ ì „í™”ê±¸ê¸°
          </button>
          ` : ''}
        </div>
      </div>
    `;
  }
}

// ì€í–‰ë³„ ê¸°ë³¸ ì •ë³´ ì œê³µ í•¨ìˆ˜
function getBankInfo(placeName) {
  const bankName = placeName.toLowerCase();
  
  // ATMì¸ì§€ í™•ì¸
  if (bankName.includes('atm') || bankName.includes('í˜„ê¸ˆìë™ì…ì¶œê¸ˆê¸°')) {
    return {
      businessHours: '24ì‹œê°„ ìš´ì˜',
      saturdayHours: '24ì‹œê°„ ìš´ì˜',
      sundayHours: '24ì‹œê°„ ìš´ì˜',
      parking: 'ATM',
      services: 'í˜„ê¸ˆì…ì¶œê¸ˆ, ì´ì²´'
    };
  }
  
  // ì¼ë°˜ì ì¸ ì€í–‰ ì •ë³´
  let defaultInfo = {
    businessHours: 'í‰ì¼ 09:00 - 16:00',
    saturdayHours: 'í† ìš”ì¼ íœ´ë¬´',
    sundayHours: 'ì¼ìš”ì¼ íœ´ë¬´',
    parking: 'ì£¼ì°¨ ê°€ëŠ¥',
    services: 'ì˜ˆê¸ˆ, ëŒ€ì¶œ, í™˜ì „, ìƒë‹´'
  };
  
  // ì€í–‰ë³„ íŠ¹í™” ì •ë³´
  if (bankName.includes('kb') || bankName.includes('êµ­ë¯¼')) {
    defaultInfo.saturdayHours = 'í† ìš”ì¼ 09:00 - 13:00';
    defaultInfo.services = 'ì˜ˆê¸ˆ, ëŒ€ì¶œ, í™˜ì „, ë³´í—˜, íˆ¬ììƒí’ˆ';
  } else if (bankName.includes('ì‹ í•œ')) {
    defaultInfo.saturdayHours = 'í† ìš”ì¼ 09:00 - 13:00';
    defaultInfo.services = 'ì˜ˆê¸ˆ, ëŒ€ì¶œ, í™˜ì „, ë³´í—˜, ì¹´ë“œë°œê¸‰';
  } else if (bankName.includes('ìš°ë¦¬')) {
    defaultInfo.services = 'ì˜ˆê¸ˆ, ëŒ€ì¶œ, í™˜ì „, ì™¸í™˜, ê¸°ì—…ë±…í‚¹';
  } else if (bankName.includes('í•˜ë‚˜')) {
    defaultInfo.services = 'ì˜ˆê¸ˆ, ëŒ€ì¶œ, í™˜ì „, ë³´í—˜, íˆ¬ì';
  } else if (bankName.includes('ì¹´ì¹´ì˜¤ë±…í¬') || bankName.includes('ì¼€ì´ë±…í¬') || bankName.includes('í† ìŠ¤ë±…í¬')) {
    defaultInfo = {
      businessHours: 'ì˜¨ë¼ì¸ ì „ìš© (24ì‹œê°„)',
      saturdayHours: 'ì˜¨ë¼ì¸ ì „ìš© (24ì‹œê°„)',
      sundayHours: 'ì˜¨ë¼ì¸ ì „ìš© (24ì‹œê°„)',
      parking: 'ë§¤ì¥ ì—†ìŒ',
      services: 'ì˜¨ë¼ì¸ ë±…í‚¹ ì „ìš©'
    };
  }
  
  return defaultInfo;
}

// ì‚¬ì´ë“œë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateSidebar(data, searchKeyword) {
  const searchInfo = document.getElementById('searchInfo');
  const bankList = document.getElementById('bankList');
  
  if (data && data.length > 0) {
    searchInfo.innerHTML = `
      <p><strong>ê²€ìƒ‰ì–´:</strong> ${searchKeyword}</p>
      <p><strong>ê²€ìƒ‰ ê²°ê³¼:</strong> ${data.length}ê°œ</p>
    `;
    
    bankList.innerHTML = '';
    bankList.style.display = 'block';
    
    data.forEach((place, index) => {
      const bankItem = document.createElement('div');
      bankItem.className = 'bank-item';
      bankItem.innerHTML = `
        <div class="bank-name">${place.place_name}</div>
        <div class="bank-address">${place.address_name}</div>
        ${place.phone ? `<div class="bank-phone">${place.phone}</div>` : ''}
      `;
      
      // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
      bankItem.addEventListener('click', () => {
        // ì´ì „ í™œì„± ìƒíƒœ ì œê±°
        document.querySelectorAll('.bank-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // í˜„ì¬ í•­ëª© í™œì„±í™”
        bankItem.classList.add('active');
        activeMarkerIndex = index;
        
        // ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
        updateDetailView(place);
        
        // ì§€ë„ ì¤‘ì‹¬ì„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
        const position = new kakao.maps.LatLng(place.y, place.x);
        map.setCenter(position);
        map.setLevel(3);
        
        // ì •ë³´ì°½ í‘œì‹œ
        infowindow.setContent(`
          <div style="padding:10px;font-size:14px;max-width:300px;line-height:1.5">
            <strong>${place.place_name}</strong><br>
            <span style="color:#777;font-size:12px">${place.address_name}</span><br>
            ${place.phone ? `<span style="color:#1a73e8;font-size:13px">${place.phone}</span>` : ''}
          </div>
        `);
        infowindow.open(map, markers[index]);
      });
      
      bankList.appendChild(bankItem);
    });
  } else {
    searchInfo.innerHTML = `
      <p><strong>ê²€ìƒ‰ì–´:</strong> ${searchKeyword}</p>
      <p><strong>ê²€ìƒ‰ ê²°ê³¼:</strong> ê²°ê³¼ ì—†ìŒ</p>
    `;
    bankList.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    bankList.style.display = 'block';
  }
}

// ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
function searchBanks() {
  const sido = sidoSelect.value;
  const sigungu = sigunguSelect.value;
  const bank = document.getElementById('bank').value;

  if (!sido || !sigungu || !bank) {
    alert("ëª¨ë“  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }

  const keyword = `${sido} ${sigungu} ${bank}`;
  console.log("ğŸ” ê²€ìƒ‰ í‚¤ì›Œë“œ:", keyword);

  // ì´ì „ ë§ˆì»¤ ì œê±°
  markers.forEach(marker => marker.setMap(null));
  markers = [];
  activeMarkerIndex = -1;

  ps.keywordSearch(keyword, function (data, status) {
    if (status === kakao.maps.services.Status.OK) {
      currentBankData = data;
      const bounds = new kakao.maps.LatLngBounds();

      data.forEach((place, index) => {
        const position = new kakao.maps.LatLng(place.y, place.x);
        const marker = new kakao.maps.Marker({
          map: map,
          position: position
        });

        kakao.maps.event.addListener(marker, 'click', function () {
          // ì‚¬ì´ë“œë°”ì—ì„œ í•´ë‹¹ í•­ëª© í™œì„±í™”
          document.querySelectorAll('.bank-item').forEach(item => {
            item.classList.remove('active');
          });
          
          const bankItems = document.querySelectorAll('.bank-item');
          if (bankItems[index]) {
            bankItems[index].classList.add('active');
            bankItems[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          
          activeMarkerIndex = index;
          
          // ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
          updateDetailView(place);
          
          infowindow.setContent(`
            <div style="padding:10px;font-size:14px;max-width:300px;line-height:1.5">
              <strong>${place.place_name}</strong><br>
              <span style="color:#777;font-size:12px">${place.address_name}</span><br>
              ${place.phone ? `<span style="color:#1a73e8;font-size:13px">${place.phone}</span>` : ''}
            </div>
          `);
          infowindow.open(map, marker);
        });

        markers.push(marker);
        bounds.extend(position);
      });

      map.setBounds(bounds);
      updateSidebar(data, keyword);
    } else {
      alert("í•´ë‹¹ ì§€ì—­ì˜ ì€í–‰ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      console.log("ê²€ìƒ‰ ì‹¤íŒ¨ ìƒíƒœ:", status);
      updateSidebar([], keyword);
    }
  });
}

// ì§€ë„ì—ì„œ ë³´ê¸° í•¨ìˆ˜
function focusOnMap() {
  if (selectedBank) {
    const position = new kakao.maps.LatLng(selectedBank.y, selectedBank.x);
    map.setCenter(position);
    map.setLevel(2);
    
    // ì •ë³´ì°½ í‘œì‹œ
    infowindow.setContent(`
      <div style="padding:10px;font-size:14px;max-width:300px;line-height:1.5">
        <strong>${selectedBank.place_name}</strong><br>
        <span style="color:#777;font-size:12px">${selectedBank.address_name}</span><br>
        ${selectedBank.phone ? `<span style="color:#1a73e8;font-size:13px">${selectedBank.phone}</span>` : ''}
      </div>
    `);
    
    if (markers[activeMarkerIndex]) {
      infowindow.open(map, markers[activeMarkerIndex]);
    }
    
    // ê²€ìƒ‰ ê²°ê³¼ íƒ­ìœ¼ë¡œ ì „í™˜
    switchTab('list');
  }
}

// ì „í™”ê±¸ê¸° í•¨ìˆ˜
function callBank() {
  if (selectedBank && selectedBank.phone) {
    window.location.href = `tel:${selectedBank.phone}`;
  }
}

// ì¹´ì¹´ì˜¤ë§µì—ì„œ ë³´ê¸° í•¨ìˆ˜
function openKakaoMap() {
  if (selectedBank) {
    const url = `https://map.kakao.com/link/map/${selectedBank.place_name},${selectedBank.y},${selectedBank.x}`;
    window.open(url, '_blank');
  }
}

// ê¸¸ì°¾ê¸° í•¨ìˆ˜
function getDirections() {
  if (selectedBank) {
    const url = `https://map.kakao.com/link/to/${selectedBank.place_name},${selectedBank.y},${selectedBank.x}`;
    window.open(url, '_blank');
  }
}

// ìœ„ì¹˜ ê³µìœ  í•¨ìˆ˜
function shareLocation() {
  if (selectedBank && navigator.share) {
    navigator.share({
      title: selectedBank.place_name,
      text: `${selectedBank.place_name} - ${selectedBank.address_name}`,
      url: window.location.href
    }).catch(console.error);
  } else if (selectedBank) {
    // Web Share APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° í´ë¦½ë³´ë“œì— ë³µì‚¬
    const shareText = `${selectedBank.place_name}\n${selectedBank.address_name}\n${window.location.href}`;
    
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(shareText).then(() => {
        alert('ìœ„ì¹˜ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }).catch(() => {
        fallbackCopyToClipboard(shareText);
      });
    } else {
      fallbackCopyToClipboard(shareText);
    }
  }
}

// í´ë¦½ë³´ë“œ ë³µì‚¬ ëŒ€ì²´ í•¨ìˆ˜
function fallbackCopyToClipboard(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  textArea.style.top = '-999999px';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    alert('ìœ„ì¹˜ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch (err) {
    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
    prompt('ë‹¤ìŒ ë‚´ìš©ì„ ë³µì‚¬í•˜ì„¸ìš”:', text);
  } finally {
    document.body.removeChild(textArea);
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ë Œë”ë§
window.onload = function() {
  console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
  
  // ì§€ë„ í¬ê¸° ì¡°ì •ì„ ìœ„í•œ ì´ë²¤íŠ¸
  window.addEventListener('resize', function() {
    map.relayout();
  });
  
  // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í™•ì¸
  setTimeout(() => {
    if (window.kakao && window.kakao.maps) {
      console.log('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í™•ì¸ë¨');
    } else {
      console.error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨');
    }
  }, 1000);
};
</script>

</body>
</html>